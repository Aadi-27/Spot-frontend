<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mapquest example</title>
    <link href="index.css" rel="stylesheet">
    
    <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"></script>
    <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css"/>
    <body>
      <h1>Simple Mapquest example</h1>
      <div class="container">
        <div id="map" class="left-part"></div>
        <div class="right-part">
          <h3>Enter Address:</h3>
          <form class="searchform">
            <p>
              <label for="search">Location:</label>
              <input type="text" class="locate" placeholder="15th cross, KumarSwamy Layout, Bengaluru, India"/>
            </p>
            <p>
              <label for="search">Alternate Location:</label>
              <input type="text" class="max-result" placeholder="Bengaluru, India"/>
            </p>
            <p>
              <button class="submit">Search</button>
            </p>
          </form>
        </div>
      </div>
    </body>
    <script>
      // 1. The basic part of the example
      var L;

      window.onload = function() {
        var key = 'CKAmoGBcfGbC5YYBClgWmQAujnGrNQm1';
        L.mapquest.key = key;
        var baseLayer = L.mapquest.tileLayer('map')

        // Geocode three locations, then call the createMap callback
        L.mapquest.geocoding().geocode(['Portland, OR', 'Flagstaff, AZ', 'Denver, CO'], showMap)

        // 'map' refers to a <div> element with the ID map
        function showMap(err, response){
          var map = createMap();
          map.addControl(L.mapquest.control());
          addLayerControl(map);
        //   // Generate the feature group containing markers from the geocoded locations
        //   var featureGroup = generateMarkersFeatureGroup(response);

        //   // Add markers to the map and zoom to the features
        //   featureGroup.addTo(map);
        //   map.fitBounds(featureGroup.getBounds());
        //   generateMarkersFeatureGroup(response);
        
        // }

        // function generateMarkersFeatureGroup(response) {
        //   var group = [];
        //   for (var i = 0; i < response.results.length; i++) {
        //     var location = response.results[i].locations[0];
        //     var locationLatLng = location.latLng;

        //     // Create a marker for each location
        //     var marker = L.marker(locationLatLng, {icon: L.mapquest.icons.marker()})
        //       .bindPopup(location.adminArea5 + ', ' + location.adminArea3);

        //     group.push(marker);
        //   }
        //   return L.featureGroup(group);
        }

        function createMap() {
          var map = L.mapquest.map('map', {
            center: [40.7237, -73.9825],
            zoom: 14,
            layers: baseLayer
          });
          return map;
        }

        function addLayerControl(map) {
          L.control.layers({
            'Map': baseLayer,
            'Hybrid': L.mapquest.tileLayer('hybrid'),
            'Light': L.mapquest.tileLayer('light'),
            'Dark' : L.mapquest.tileLayer('dark') 
            
          }, {}, { position: 'topleft'}).addTo(map);
        }
      }

      // Defining a baseurl and key to as part of the request URL

      var baseURL = 'https://www.mapquestapi.com/geocoding/v1/address';
      var key = 'CKAmoGBcfGbC5YYBClgWmQAujnGrNQm1';
      var url;

      // Grab references to all the DOM elements you'll need to manipulate

      var locate = document.querySelector('.locate');
      var maxResults = document.querySelector('.max-result');
      var submitBtn = document.querySelector('.submit');
      var searchForm = document.querySelector('.searchform');
      var coordinates = [];

      // Event Listeners
      searchForm.addEventListener('submit', submitSearch);

      function submitSearch(e) {
        fetchResults(e);
      }

      function fetchResults(e) {
        e.preventDefault();

        // Assemble the full URL
        url = baseURL + '?key=' + key + '&inFormat=kvp&outFormat=json&location=' + locate.value + '&thumbMaps=false'

        // Use fetch() to make the request to the API
        fetch(url).then(response => {
          console.log(response);
          return response.json();
        }).then(data => {
          coordinates.push(data);
        })
        
      }
      var found = coordinates.filter(function(item) {
          return item[0].results[0].locations[0].latLng
        });
        console.log(found)

    </script>
  </head>
</html>